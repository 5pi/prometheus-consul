#!/bin/sh

/usr/bin/runsv /etc/service/prometheus &
RUNSV=$!

# We need to stop runsv so it stops prometheus gracefully
trap "kill $RUNSV; wait $RUNSV" TERM INT

# consul needs to run backgrounded, otherwise shell won't handle signals
/usr/bin/consul-template \
    -template="/etc/prometheus.conf.tmpl:/etc/prometheus.conf:sv restart prometheus" $@ &

wait $! $RUNSV
